import{c as B,r as k,j as e,P as K,U as V,b as J,S as Y,E as W,C as G,M as Q,d as Z,e as ee,T as te,f as re,g as X,h as se,i as _,k as L,F as M,l as ae,m as de,n as oe,o as ne,L as le,p as ie,q as ce,G as me,s as ue}from"./vendor_react-mUKfqaQ0.js";import{a as xe,u as ge,b as he,D as pe,c as be,S as ye,v as fe,P as ke,d as ve,C as je}from"./vendor_dndkit-X4H33ZK4.js";import{g as we,i as Ne,a as Fe,b as Se,c as Ce,s as Ie,d as D,o as Ee,e as U,f as Te,q as H,h as R,j as $,k as De,l as z,m as Oe,n as Ae,p as Le}from"./vendor_firebase-Cb1zNtEj.js";import"./vendor-BEISuC0C.js";import"./vendor_zustand-DtBHub2h.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const Pe=typeof __firebase_config<"u"?JSON.parse(__firebase_config):{apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"};let P;we().length?P=Fe():P=Ne(Pe);const I=Se(P),A=Ce(P);Ie("debug");const E=typeof __app_id<"u"?__app_id:"default-form-builder",f=B(d=>({theme:localStorage.getItem("theme")||"light",currentView:"builder",currentFormIdForFiller:null,currentFormIdForResponses:null,isLoading:!1,toastMessage:null,isAuthReady:!1,userId:null,previewDevice:"desktop",showShareModal:!1,shareableLink:"",setTheme:n=>{d({theme:n}),localStorage.setItem("theme",n),n==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},setCurrentView:(n,r=null)=>{d({currentView:n}),n==="filler"&&d({currentFormIdForFiller:r}),n==="responses"&&d({currentFormIdForResponses:r})},setLoading:n=>d({isLoading:n}),setToast:(n,r=3e3)=>{d({toastMessage:n}),n&&r&&setTimeout(()=>d({toastMessage:null}),r)},setAuthReady:n=>d({isAuthReady:n}),setUserId:n=>d({userId:n}),setPreviewDevice:n=>d({previewDevice:n}),setShowShareModal:(n,r="")=>d({showShareModal:n,shareableLink:r})})),_e=(()=>{const d={id:crypto.randomUUID(),type:"TEXT",label:"Name",placeholder:"Enter your full name",required:!0,helpText:""},n={id:crypto.randomUUID(),type:"TEXT",label:"Email",placeholder:"Enter your email address",required:!0,helpText:""},r={id:crypto.randomUUID(),type:"TEXTAREA",label:"Message",placeholder:"Enter your message",required:!0,helpText:"",rows:4},a=crypto.randomUUID();return{title:"Contact Us",description:"Please fill out the form below to contact us.",fields:[d,n,r],steps:[{id:a,name:"Step 1",fieldIds:[d.id,n.id,r.id]}],currentStepId:a,settings:{theme:"default"},createdAt:D(),updatedAt:D()}})(),S=B((d,n)=>({forms:[],currentForm:null,selectedFieldId:null,history:[],historyIndex:-1,draggedFieldType:null,initializeForms:async r=>{if(!r)return;f.getState().setLoading(!0);const a=`artifacts/${E}/users/${r}/forms`,s=H(R(I,a));return $(s,c=>{const u=[];c.forEach(m=>{u.push({id:m.id,...m.data()})}),d({forms:u}),f.getState().setLoading(!1)},c=>{console.error("Error fetching forms: ",c),f.getState().setToast("Error fetching forms.",5e3),f.getState().setLoading(!1)})},createNewForm:()=>{const r={id:crypto.randomUUID(),title:"Untitled Form",description:"",fields:[],steps:[{id:crypto.randomUUID(),name:"Step 1",fieldIds:[]}],currentStepId:null,settings:{theme:"default"},createdAt:D(),updatedAt:D()};r.currentStepId=r.steps[0].id,d({currentForm:r,selectedFieldId:null,history:[r],historyIndex:0}),n().saveCurrentForm()},createContactUsForm:()=>{const r=JSON.parse(JSON.stringify(_e));r.id=crypto.randomUUID(),r.fields.forEach((a,s)=>{const i=crypto.randomUUID();r.steps[0].fieldIds[s]=i,a.id=i}),r.steps[0].id=crypto.randomUUID(),r.currentStepId=r.steps[0].id,d({currentForm:r,selectedFieldId:null,history:[r],historyIndex:0}),n().saveCurrentForm(),n().loadFormForEditing(r.id)},loadFormForEditing:r=>{const a=n().forms.find(s=>s.id===r);if(a){const s={...a,steps:a.steps&&a.steps.length>0?a.steps:[{id:crypto.randomUUID(),name:"Step 1",fieldIds:[]}]};!s.currentStepId&&s.steps.length>0?s.currentStepId=s.steps[0].id:s.steps.length===0&&(s.currentStepId=null),d({currentForm:s,selectedFieldId:null,history:[s],historyIndex:0})}else f.getState().setToast(`Form with ID ${r} not found.`,5e3)},saveCurrentForm:async()=>{const{currentForm:r}=n(),a=f.getState().userId;if(!r||!a)return;f.getState().setLoading(!0);const s={...r,updatedAt:D()},i=U(I,`artifacts/${E}/users/${a}/forms`,r.id);try{await Te(i,s,{merge:!0}),f.getState().setToast("Form saved!",2e3),d(c=>({forms:c.forms.map(u=>u.id===r.id?s:u)}))}catch(c){console.error("Error saving form: ",c),f.getState().setToast("Error saving form. Check console.",5e3)}finally{f.getState().setLoading(!1)}},updateFormDetails:r=>{d(a=>{if(!a.currentForm)return{};const s={...a.currentForm,...r};return n()._addHistory(s),{currentForm:s}})},addField:r=>{d(a=>{if(!a.currentForm||!a.currentForm.currentStepId)return{};const s={...r,id:crypto.randomUUID()},i=[...a.currentForm.fields,s],c=a.currentForm.steps.map(m=>m.id===a.currentForm.currentStepId?{...m,fieldIds:[...m.fieldIds||[],s.id]}:m),u={...a.currentForm,fields:i,steps:c};return n()._addHistory(u),{currentForm:u,selectedFieldId:s.id}})},updateField:(r,a)=>{d(s=>{if(!s.currentForm)return{};const i=s.currentForm.fields.map(u=>u.id===r?{...u,...a}:u),c={...s.currentForm,fields:i};return n()._addHistory(c),{currentForm:c}})},deleteField:r=>{d(a=>{if(!a.currentForm)return{};const s=a.currentForm.fields.filter(m=>m.id!==r),i=a.currentForm.steps.map(m=>({...m,fieldIds:(m.fieldIds||[]).filter(p=>p!==r)})),c={...a.currentForm,fields:s,steps:i},u=a.selectedFieldId===r?null:a.selectedFieldId;return n()._addHistory(c),{currentForm:c,selectedFieldId:u}})},reorderFields:(r,a)=>{d(s=>{if(!s.currentForm||!s.currentForm.currentStepId)return{};const i=s.currentForm.steps.find(p=>p.id===s.currentForm.currentStepId);if(!i||!i.fieldIds)return{};const c=xe(i.fieldIds,r,a),u=s.currentForm.steps.map(p=>p.id===s.currentForm.currentStepId?{...p,fieldIds:c}:p),m={...s.currentForm,steps:u};return n()._addHistory(m),{currentForm:m}})},selectField:r=>d({selectedFieldId:r}),addStep:()=>{d(r=>{if(!r.currentForm)return{};const a={id:crypto.randomUUID(),name:`Step ${r.currentForm.steps.length+1}`,fieldIds:[]},s=[...r.currentForm.steps,a],i={...r.currentForm,steps:s,currentStepId:a.id};return n()._addHistory(i),{currentForm:i}})},updateStep:(r,a)=>{d(s=>{if(!s.currentForm)return{};const i=s.currentForm.steps.map(u=>u.id===r?{...u,...a}:u),c={...s.currentForm,steps:i};return n()._addHistory(c),{currentForm:c}})},deleteStep:r=>{d(a=>{if(!a.currentForm||a.currentForm.steps.length<=1)return f.getState().setToast("Cannot delete the last step.",3e3),{};const s=a.currentForm.steps.find(m=>m.id===r),i=a.currentForm.steps.filter(m=>m.id!==r);let c=a.currentForm.currentStepId===r?i.length>0?i[0].id:null:a.currentForm.currentStepId;if(s&&s.fieldIds&&s.fieldIds.length>0&&i.length>0){const m=Math.max(0,i.findIndex(p=>p.id===c));i[m].fieldIds=[...i[m].fieldIds||[],...s.fieldIds||[]]}const u={...a.currentForm,steps:i,currentStepId:c};return n()._addHistory(u),{currentForm:u}})},setCurrentStepId:r=>{d(a=>a.currentForm?{currentForm:{...a.currentForm,currentStepId:r}}:{})},_addHistory:r=>{d(a=>{const s=a.history.slice(0,a.historyIndex+1);return s.push(JSON.parse(JSON.stringify(r))),{history:s,historyIndex:s.length-1}})},undo:()=>{d(r=>{if(r.historyIndex>0){const a=r.historyIndex-1;return{currentForm:JSON.parse(JSON.stringify(r.history[a])),historyIndex:a,selectedFieldId:null}}return{}})},redo:()=>{d(r=>{if(r.historyIndex<r.history.length-1){const a=r.historyIndex+1;return{currentForm:JSON.parse(JSON.stringify(r.history[a])),historyIndex:a,selectedFieldId:null}}return{}})}})),C={TEXT:{type:"TEXT",label:"Text Input",icon:e.jsx(ce,{size:18}),defaultProps:{label:"Text Field",placeholder:"Enter text",required:!1,helpText:"",minLength:0,maxLength:255,pattern:""}},TEXTAREA:{type:"TEXTAREA",label:"Textarea",icon:e.jsx(ie,{size:18}),defaultProps:{label:"Textarea Field",placeholder:"Enter longer text",required:!1,helpText:"",rows:3,minLength:0,maxLength:1e3}},DROPDOWN:{type:"DROPDOWN",label:"Dropdown",icon:e.jsx(le,{size:18}),defaultProps:{label:"Dropdown Field",required:!1,helpText:"",options:[{value:"option1",label:"Option 1"},{value:"option2",label:"Option 2"}]}},CHECKBOX:{type:"CHECKBOX",label:"Checkbox",icon:e.jsx(X,{size:18}),defaultProps:{label:"Checkbox Field",required:!1,helpText:"",options:[{value:"choice1",label:"Choice 1",checked:!1}]}},DATE:{type:"DATE",label:"Date Picker",icon:e.jsx(ne,{size:18}),defaultProps:{label:"Date Field",required:!1,helpText:""}},FILE:{type:"FILE",label:"File Upload",icon:e.jsx(M,{size:18}),defaultProps:{label:"File Upload",required:!1,helpText:"",multiple:!1,accept:"*"}}},Ue=({id:d,field:n,onSelect:r,onDelete:a,isSelected:s})=>{const{attributes:i,listeners:c,setNodeRef:u,transform:m,transition:p,isDragging:g}=ve({id:d}),t={transform:je.Transform.toString(m),transition:p,opacity:g?.5:1,zIndex:g?100:"auto",touchAction:"none"},o=C[n.type];return e.jsxs("div",{ref:u,style:t,className:`p-4 mb-3 rounded-lg shadow-md cursor-default border-2 ${s?"border-blue-500 bg-blue-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>r(n.id),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{...i,...c,className:"cursor-grab p-1 mr-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(me,{size:20})}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:n.label||(o==null?void 0:o.label)||"Field"}),n.required&&e.jsx("span",{className:"ml-2 text-red-500",children:"*"})]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),a(n.id)},className:"p-1 text-red-500 hover:text-red-700",children:e.jsx(_,{size:18})})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:n.placeholder||n.helpText||"No placeholder or help text"}),n.type==="TEXT"&&e.jsx("input",{type:"text",placeholder:n.placeholder,className:"mt-2 p-2 border rounded-md w-full dark:bg-gray-700 dark:border-gray-600",readOnly:!0}),n.type==="TEXTAREA"&&e.jsx("textarea",{placeholder:n.placeholder,rows:n.rows||2,className:"mt-2 p-2 border rounded-md w-full dark:bg-gray-700 dark:border-gray-600",readOnly:!0})]})},Re=()=>{const d=Object.keys(C);return e.jsxs("div",{className:"w-72 bg-gray-50 dark:bg-gray-800 p-4 border-r dark:border-gray-700 h-full overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:"Form Elements"}),d.map(n=>e.jsxs("div",{draggable:!0,onDragStart:r=>{r.dataTransfer.setData("fieldType",n)},className:"w-full flex items-center space-x-2 p-3 mb-2 bg-white dark:bg-gray-700 rounded-md shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 text-left text-gray-700 dark:text-gray-300 cursor-grab",style:{userSelect:"none"},children:[C[n].icon,e.jsx("span",{children:C[n].label})]},n))]})},$e=()=>{const{currentForm:d,selectedFieldId:n,selectField:r,deleteField:a,reorderFields:s,addField:i}=S(),c=ge(he(ke,{activationConstraint:{distance:8}}));if(!d)return e.jsx("div",{className:"flex-1 p-8 flex items-center justify-center text-gray-500 dark:text-gray-400",children:"Select or create a form to start building."});const u=d.steps.find(t=>t.id===d.currentStepId),m=u?(u.fieldIds||[]).map(t=>d.fields.find(o=>o.id===t)).filter(Boolean):[],p=t=>{const{active:o,over:x}=t;if(o.id!==x.id&&x){const b=m.findIndex(l=>l.id===o.id),j=m.findIndex(l=>l.id===x.id);b!==-1&&j!==-1&&s(b,j)}},g=t=>{const o=t.dataTransfer.getData("fieldType");o&&C[o]&&i({type:C[o].type,...C[o].defaultProps})};return e.jsx(pe,{sensors:c,collisionDetection:be,onDragEnd:p,children:e.jsxs("div",{className:"flex-1 p-4 md:p-8 overflow-y-auto",onDragOver:t=>t.preventDefault(),onDrop:g,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"text",value:d.title,onChange:t=>S.getState().updateFormDetails({title:t.target.value}),className:"text-2xl font-bold p-2 border-b-2 border-transparent focus:border-blue-500 outline-none bg-transparent w-full dark:text-white",placeholder:"Form Title"}),e.jsx("textarea",{value:d.description,onChange:t=>S.getState().updateFormDetails({description:t.target.value}),className:"text-sm text-gray-600 dark:text-gray-300 p-2 mt-1 border-b-2 border-transparent focus:border-blue-500 outline-none bg-transparent w-full",placeholder:"Form description (optional)",rows:"2"})]}),e.jsx(qe,{}),u&&m.length>0?e.jsx(ye,{items:m.map(t=>t.id),strategy:fe,children:m.map(t=>e.jsx(Ue,{id:t.id,field:t,onSelect:r,onDelete:a,isSelected:n===t.id},t.id))}):e.jsxs("div",{className:"min-h-[200px] border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex flex-col items-center justify-center p-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"Drag elements from the left panel or click to add them here."}),e.jsxs("p",{className:"text-sm mt-1",children:["This is the canvas for '",(u==null?void 0:u.name)||"current step","'."]})]})]})})},qe=()=>{const{currentForm:d,setCurrentStepId:n,addStep:r,deleteStep:a,updateStep:s}=S(),[i,c]=k.useState(null),[u,m]=k.useState("");if(!d||!d.steps)return null;const p=t=>{c(t.id),m(t.name)},g=t=>{u.trim()&&s(t,{name:u.trim()}),c(null)};return e.jsxs("div",{className:"mb-6 flex items-center border-b border-gray-200 dark:border-gray-700 pb-2",children:[e.jsx("nav",{className:"flex space-x-1 flex-wrap",children:d.steps.map((t,o)=>e.jsxs("div",{className:"relative group",children:[i===t.id?e.jsx("input",{type:"text",value:u,onChange:x=>m(x.target.value),onBlur:()=>g(t.id),onKeyPress:x=>x.key==="Enter"&&g(t.id),className:"px-3 py-2 text-sm font-medium rounded-md bg-transparent border border-blue-500 text-blue-600 dark:text-blue-400",autoFocus:!0}):e.jsx("button",{onClick:()=>n(t.id),onDoubleClick:()=>p(t),className:`px-3 py-2 text-sm font-medium rounded-md ${d.currentStepId===t.id?"bg-blue-100 text-blue-700 dark:bg-blue-700 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:t.name||`Step ${o+1}`}),d.steps.length>1&&e.jsx("button",{onClick:()=>a(t.id),className:"absolute -top-2 -right-2 p-0.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete step",children:e.jsx(_,{size:12})})]},t.id))}),e.jsx("button",{onClick:r,className:"ml-2 p-2 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",title:"Add new step",children:e.jsx(L,{size:20})})]})},ze=()=>{const{currentForm:d,selectedFieldId:n,updateField:r}=S(),[a,s]=k.useState({}),i=d==null?void 0:d.fields.find(t=>t.id===n);k.useEffect(()=>{s(i?{...i}:{})},[n,d]);const c=t=>{const{name:o,value:x,type:b,checked:j}=t.target;s(l=>({...l,[o]:b==="checkbox"?j:x}))},u=(t,o,x)=>{s(b=>{const j=[...b.options||[]];return j[t]={...j[t],[o]:x},{...b,options:j}})},m=()=>{s(t=>({...t,options:[...t.options||[],{value:`new_option_${(t.options||[]).length+1}`,label:"New Option"}]}))},p=t=>{s(o=>({...o,options:(o.options||[]).filter((x,b)=>b!==t)}))};if(k.useEffect(()=>{if(!n||Object.keys(a).length===0||JSON.stringify(a)===JSON.stringify(i))return;const t=setTimeout(()=>{r(n,a)},500);return()=>clearTimeout(t)},[a,n,r,i]),!i)return e.jsx("div",{className:"w-80 bg-gray-50 dark:bg-gray-800 p-4 border-l dark:border-gray-700 h-full text-gray-500 dark:text-gray-400",children:"Select a field to edit its properties."});const g=C[i.type];return e.jsxs("div",{className:"w-80 bg-gray-50 dark:bg-gray-800 p-4 border-l dark:border-gray-700 h-full overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:["Properties: ",g==null?void 0:g.label]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"label",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Label"}),e.jsx("input",{type:"text",name:"label",id:"label",value:a.label||"",onChange:c,className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"placeholder",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Placeholder"}),e.jsx("input",{type:"text",name:"placeholder",id:"placeholder",value:a.placeholder||"",onChange:c,className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"helpText",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Help Text"}),e.jsx("textarea",{name:"helpText",id:"helpText",value:a.helpText||"",onChange:c,rows:"2",className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-2"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"required",id:"required",checked:a.required||!1,onChange:c,className:"h-4 w-4 text-blue-600 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:"required",className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:"Required"})]}),i.type==="TEXTAREA"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rows",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rows"}),e.jsx("input",{type:"number",name:"rows",id:"rows",value:a.rows||3,onChange:c,className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-2"})]}),(i.type==="DROPDOWN"||i.type==="CHECKBOX")&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Options"}),(a.options||[]).map((t,o)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"text",placeholder:"Label",value:t.label,onChange:x=>u(o,"label",x.target.value),className:"flex-1 shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-1.5"}),e.jsx("input",{type:"text",placeholder:"Value",value:t.value,onChange:x=>u(o,"value",x.target.value),className:"flex-1 shadow-sm sm:text-sm border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white p-1.5"}),i.type==="CHECKBOX"&&e.jsx("input",{type:"checkbox",title:"Default Checked",checked:t.checked||!1,onChange:x=>u(o,"checked",x.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),e.jsx("button",{onClick:()=>p(o),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(_,{size:16})})]},o)),e.jsxs("button",{onClick:m,className:"mt-1 text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 flex items-center",children:[e.jsx(L,{size:16,className:"mr-1"})," Add Option"]})]})]})]})},Be=({form:d,device:n="desktop"})=>{var g;if(!d)return e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No form to preview."});const[r,a]=k.useState({}),[s,i]=k.useState(0);k.useEffect(()=>{const t={};d.fields.forEach(o=>{o.type==="CHECKBOX"&&o.options?(t[o.id]={},o.options.forEach(x=>t[o.id][x.value]=x.checked||!1)):t[o.id]=""}),a(t),i(0)},[d]);const c=(t,o,x=null)=>{a(b=>{var l;const j={...b};return((l=d.fields.find(h=>h.id===t))==null?void 0:l.type)==="CHECKBOX"?(j[t]||(j[t]={}),j[t][x]=o):j[t]=o,j})},u=t=>{t.preventDefault(),f.getState().setToast("Preview submission: "+JSON.stringify(r),5e3)},m=d.steps&&d.steps[s]?(d.steps[s].fieldIds||[]).map(t=>d.fields.find(o=>o.id===t)).filter(Boolean):d.fields,p={desktop:"w-full max-w-2xl",tablet:"w-full max-w-md",mobile:"w-full max-w-sm"};return e.jsxs("div",{className:`mx-auto p-6 bg-white dark:bg-gray-800 shadow-xl rounded-lg ${p[n]}`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-1 text-gray-900 dark:text-white",children:d.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:d.description}),d.steps&&d.steps.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:["Step ",s+1," of ",d.steps.length,": ",(g=d.steps[s])==null?void 0:g.name]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${(s+1)/d.steps.length*100}%`}})})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[m.map(t=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:t.id,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.label," ",t.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),t.helpText&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:t.helpText}),t.type==="TEXT"&&e.jsx("input",{type:"text",id:t.id,name:t.id,placeholder:t.placeholder,required:t.required,value:r[t.id]||"",onChange:o=>c(t.id,o.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),t.type==="TEXTAREA"&&e.jsx("textarea",{id:t.id,name:t.id,placeholder:t.placeholder,rows:t.rows||3,required:t.required,value:r[t.id]||"",onChange:o=>c(t.id,o.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),t.type==="DROPDOWN"&&e.jsxs("select",{id:t.id,name:t.id,required:t.required,value:r[t.id]||"",onChange:o=>c(t.id,o.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:t.placeholder||"Select an option"}),(t.options||[]).map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),t.type==="CHECKBOX"&&(t.options||[]).map(o=>{var x;return e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("input",{type:"checkbox",id:`${t.id}-${o.value}`,name:`${t.id}-${o.value}`,value:o.value,checked:((x=r[t.id])==null?void 0:x[o.value])||!1,onChange:b=>c(t.id,b.target.checked,o.value),className:"h-4 w-4 text-blue-600 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:`${t.id}-${o.value}`,className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:o.label})]},o.value)}),t.type==="DATE"&&e.jsx("input",{type:"date",id:t.id,name:t.id,required:t.required,value:r[t.id]||"",onChange:o=>c(t.id,o.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),t.type==="FILE"&&e.jsx("input",{type:"file",id:t.id,name:t.id,required:t.required,multiple:t.multiple,accept:t.accept,onChange:o=>c(t.id,o.target.files.length>0?o.target.files[0].name:""),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-blue-300 dark:hover:file:bg-gray-600"})]},t.id)),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[s>0&&e.jsx("button",{type:"button",onClick:()=>i(t=>t-1),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:"Previous"}),d.steps&&s<d.steps.length-1?e.jsx("button",{type:"button",onClick:()=>i(t=>t+1),className:"ml-auto px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Next"}):e.jsx("button",{type:"submit",className:"ml-auto px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700",children:"Submit Preview"})]})]})]})},Xe=({formId:d,creatorId:n})=>{const{setToast:r,setLoading:a}=f(),[s,i]=k.useState(null),[c,u]=k.useState({}),[m,p]=k.useState(0),[g,t]=k.useState(!1);k.useEffect(()=>{if(!d||!n){r("Form ID or Creator ID is missing.",5e3);return}a(!0);const l=U(I,`artifacts/${E}/users/${n}/forms`,d),h=$(l,w=>{if(w.exists()){const y=w.data();i({id:w.id,...y});const v={};y.fields.forEach(N=>{N.type==="CHECKBOX"&&N.options?(v[N.id]={},N.options.forEach(F=>v[N.id][F.value]=F.checked||!1)):v[N.id]=""}),u(v),p(0)}else r("Form not found or you don't have access.",5e3),i(null);a(!1)},w=>{console.error("Error fetching form for filling: ",w),r("Error fetching form. "+w.message,5e3),a(!1)});return()=>h()},[d,n,r,a]);const o=(l,h,w=null)=>{u(y=>{var N;const v={...y};return((N=s.fields.find(F=>F.id===l))==null?void 0:N.type)==="CHECKBOX"?(v[l]||(v[l]={}),v[l][w]=h):v[l]=h,v})},x=async l=>{if(l.preventDefault(),!s)return;t(!0),r("Submitting...",null);const h=s.steps[m].fieldIds.map(y=>s.fields.find(v=>v.id===y)).filter(Boolean);for(const y of h)if(y.required){if(y.type==="CHECKBOX"){if(!y.options.some(N=>{var F;return(F=c[y.id])==null?void 0:F[N.value]})){r(`Field "${y.label}" is required. Please check at least one option.`,3e3),t(!1);return}}else if(!c[y.id]||String(c[y.id]).trim()===""){r(`Field "${y.label}" is required.`,3e3),t(!1);return}}if(m<s.steps.length-1){p(y=>y+1),t(!1),r(null);return}const w={formId:s.id,submittedAt:D(),data:c};try{const y=`artifacts/${E}/users/${n}/forms/${d}/responses`;await Ae(R(I,y),w),r("Form submitted successfully!",5e3);const v={};s.fields.forEach(N=>{N.type==="CHECKBOX"&&N.options?(v[N.id]={},N.options.forEach(F=>v[N.id][F.value]=F.checked||!1)):v[N.id]=""}),u(v),p(0)}catch(y){console.error("Error submitting form: ",y),r("Error submitting form. "+y.message,5e3)}finally{t(!1)}};if(!s)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 shadow-lg rounded-md text-gray-700 dark:text-gray-300",children:"Loading form... If it takes too long, the form may not exist or the link is incorrect."})});const b=s.steps[m],j=b?(b.fieldIds||[]).map(l=>s.fields.find(h=>h.id===l)).filter(Boolean):[];return e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 py-8 px-4 flex flex-col items-center",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-gray-800 shadow-xl rounded-lg p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:s.description}),s.steps&&s.steps.length>1&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:["Step ",m+1," of ",s.steps.length,": ",b==null?void 0:b.name]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${(m+1)/s.steps.length*100}%`}})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[j.map(l=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:l.id,className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[l.label," ",l.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),l.helpText&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:l.helpText}),l.type==="TEXT"&&e.jsx("input",{type:"text",id:l.id,name:l.id,placeholder:l.placeholder,required:l.required,value:c[l.id]||"",onChange:h=>o(l.id,h.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.type==="TEXTAREA"&&e.jsx("textarea",{id:l.id,name:l.id,placeholder:l.placeholder,rows:l.rows||3,required:l.required,value:c[l.id]||"",onChange:h=>o(l.id,h.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.type==="DROPDOWN"&&e.jsxs("select",{id:l.id,name:l.id,required:l.required,value:c[l.id]||"",onChange:h=>o(l.id,h.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:l.placeholder||"Select an option"}),(l.options||[]).map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]}),l.type==="CHECKBOX"&&(l.options||[]).map(h=>{var w;return e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("input",{type:"checkbox",id:`${l.id}-${h.value}`,name:`${l.id}-${h.value}`,value:h.value,checked:((w=c[l.id])==null?void 0:w[h.value])||!1,onChange:y=>o(l.id,y.target.checked,h.value),className:"h-4 w-4 text-blue-600 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:`${l.id}-${h.value}`,className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:h.label})]},h.value)}),l.type==="DATE"&&e.jsx("input",{type:"date",id:l.id,name:l.id,required:l.required,value:c[l.id]||"",onChange:h=>o(l.id,h.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.type==="FILE"&&e.jsx("input",{type:"file",id:l.id,name:l.id,required:l.required,multiple:l.multiple,accept:l.accept,onChange:h=>o(l.id,h.target.files.length>0?h.target.files[0].name:""),className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-blue-300 dark:hover:file:bg-gray-600"})]},l.id)),e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t dark:border-gray-700",children:[m>0&&e.jsx("button",{type:"button",onClick:()=>p(l=>l-1),disabled:g,className:"px-6 py-2.5 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-600 dark:text-gray-200 dark:border-gray-500 dark:hover:bg-gray-500 disabled:opacity-50",children:"Previous"}),e.jsx("button",{type:"submit",disabled:g,className:"ml-auto px-6 py-2.5 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:g?"Submitting...":m<s.steps.length-1?"Next":"Submit Form"})]})]})]}),e.jsx("button",{onClick:()=>f.getState().setCurrentView("builder"),className:"mt-8 text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"← Back to Form Builder"})]})},Me=({formId:d})=>{const{setToast:n,setLoading:r,userId:a}=f(),[s,i]=k.useState([]),[c,u]=k.useState("");return k.useEffect(()=>{if(!d||!a){n("Form ID or User ID is missing for viewing responses.",3e3);return}r(!0);const m=U(I,`artifacts/${E}/users/${a}/forms`,d);Oe(m).then(o=>{o.exists()&&u(o.data().title)});const p=`artifacts/${E}/users/${a}/forms/${d}/responses`,g=H(R(I,p)),t=$(g,o=>{const x=[];o.forEach(b=>{x.push({id:b.id,...b.data()})}),x.sort((b,j)=>{var l,h,w,y;return(((h=(l=j.submittedAt)==null?void 0:l.toDate)==null?void 0:h.call(l))||0)-(((y=(w=b.submittedAt)==null?void 0:w.toDate)==null?void 0:y.call(w))||0)}),i(x),r(!1)},o=>{console.error("Error fetching responses: ",o),n("Error fetching responses. "+o.message,5e3),r(!1)});return()=>t()},[d,a,n,r]),f.getState().isLoading&&s.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"Loading responses..."}):e.jsx("div",{className:"p-4 md:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-white",children:["Responses for: ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:c||d})]}),e.jsx("button",{onClick:()=>f.getState().setCurrentView("builder"),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md shadow-sm text-sm font-medium",children:"← Back to Builder"})]}),s.length===0&&!f.getState().isLoading&&e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-10",children:"No responses submitted for this form yet."}),e.jsx("div",{className:"space-y-6",children:s.map(m=>{var p;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:["Response ID: ",m.id.substring(0,8),"..."]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Submitted: ",(p=m.submittedAt)!=null&&p.toDate?m.submittedAt.toDate().toLocaleString():"N/A"]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(m.data||{}).map(([g,t])=>{let o=t;return typeof t=="object"&&t!==null?o=Object.entries(t).filter(([x,b])=>b).map(([x])=>x).join(", "):typeof t=="boolean"&&(o=t?"Yes":"No"),e.jsxs("div",{className:"text-sm",children:[e.jsxs("strong",{className:"text-gray-600 dark:text-gray-300",children:[g,":"]})," ",e.jsx("span",{className:"text-gray-800 dark:text-gray-100",children:String(o)})]},g)})})]},m.id)})})]})})},He=()=>{const{forms:d,createNewForm:n,loadFormForEditing:r,saveCurrentForm:a,createContactUsForm:s}=S(),{setCurrentView:i,userId:c,setShowShareModal:u}=f(),m=g=>{if(d.find(o=>o.id===g)&&c){const o=`${window.location.origin}${window.location.pathname}?view=filler&formId=${g}&creatorId=${c}`;u(!0,o)}else f.getState().setToast("Cannot generate share link.",3e3)},p=async g=>{if(!(!c||!g)&&window.confirm("Are you sure you want to delete this form and all its responses? This action cannot be undone.")){f.getState().setLoading(!0);try{const t=U(I,`artifacts/${E}/users/${c}/forms`,g);await Le(t),f.getState().setToast("Form deleted (main document only). Responses need manual/server-side cleanup.",4e3)}catch(t){console.error("Error deleting form: ",t),f.getState().setToast("Error deleting form: "+t.message,5e3)}finally{f.getState().setLoading(!1)}}};return e.jsx("div",{className:"p-4 md:p-8 bg-gray-100 dark:bg-gray-900 min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white",children:"My Forms"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{n(),i("builder-canvas")},className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm flex items-center",children:[e.jsx(L,{size:20,className:"mr-2"})," Create New Form"]}),e.jsxs("button",{onClick:()=>{s(),i("builder-canvas")},className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm flex items-center",children:[e.jsx(L,{size:20,className:"mr-2"})," Create Contact Us Form"]})]})]}),d.length===0&&!f.getState().isLoading&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx(M,{size:48,className:"mx-auto text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-2",children:"No forms yet."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:'Click "Create New Form" to get started.'})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(g=>{var t,o,x;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-5 flex-grow",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-2 truncate",title:g.title,children:g.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1 h-10 overflow-hidden",children:g.description||"No description."}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Fields: ",((t=g.fields)==null?void 0:t.length)||0,", Steps: ",((o=g.steps)==null?void 0:o.length)||0]}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Last updated: ",(x=g.updatedAt)!=null&&x.toDate?g.updatedAt.toDate().toLocaleDateString():"N/A"]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 border-t dark:border-gray-600 flex flex-wrap gap-2 justify-end",children:[e.jsxs("button",{onClick:()=>{r(g.id),i("builder-canvas")},className:"text-xs bg-blue-500 hover:bg-blue-600 text-white py-1.5 px-3 rounded-md shadow-sm flex items-center",children:[e.jsx(ae,{size:14,className:"mr-1"})," Edit"]}),e.jsxs("button",{onClick:()=>i("responses",g.id),className:"text-xs bg-green-500 hover:bg-green-600 text-white py-1.5 px-3 rounded-md shadow-sm flex items-center",children:[e.jsx(de,{size:14,className:"mr-1"})," Responses"]}),e.jsxs("button",{onClick:()=>m(g.id),className:"text-xs bg-purple-500 hover:bg-purple-600 text-white py-1.5 px-3 rounded-md shadow-sm flex items-center",children:[e.jsx(oe,{size:14,className:"mr-1"})," Share"]}),e.jsxs("button",{onClick:()=>p(g.id),className:"text-xs bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md shadow-sm flex items-center",children:[e.jsx(_,{size:14,className:"mr-1"})," Delete"]})]})]},g.id)})})]})})},Ke=()=>{const{showShareModal:d,shareableLink:n,setShowShareModal:r}=f(),[a,s]=k.useState(!1);if(!d)return null;const i=()=>{const c=document.createElement("textarea");c.value=n,document.body.appendChild(c),c.focus(),c.select();try{document.execCommand("copy"),s(!0),setTimeout(()=>s(!1),2e3)}catch(u){console.error("Failed to copy: ",u),f.getState().setToast("Failed to copy link.",3e3)}document.body.removeChild(c)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"Share Form"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"×"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Share this link with others to fill out your form:"}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-blue-600 dark:text-blue-400 underline break-all",children:n}),e.jsxs("button",{onClick:i,className:`px-4 py-2 rounded-md text-sm font-medium text-white ${a?"bg-green-500":"bg-blue-500 hover:bg-blue-600"}`,children:[a?e.jsx(X,{size:16}):e.jsx(se,{size:16})," ",a?"Copied!":"Copy"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anyone with this link will be able to access and submit this form. Ensure your Firebase security rules allow read access to the form structure for unauthenticated users if needed, or that users are authenticated."})]})})},Ve=()=>{const{theme:d,setTheme:n,currentView:r,currentFormIdForFiller:a,currentFormIdForResponses:s,isLoading:i,toastMessage:c,isAuthReady:u,userId:m,setAuthReady:p,setUserId:g,previewDevice:t,setPreviewDevice:o}=f(),{currentForm:x,saveCurrentForm:b,undo:j,redo:l,initializeForms:h}=S(),[w,y]=k.useState(!1);k.useEffect(()=>{const F=Ee(A,async T=>{if(T)g(T.uid),p(!0),console.log("User is signed in with UID:",T.uid),h(T.uid);else if(typeof __initial_auth_token<"u"&&__initial_auth_token)try{await De(A,__initial_auth_token)}catch(O){console.error("Error signing in with custom token, trying anonymous:",O),await z(A)}else console.log("No initial auth token, signing in anonymously."),await z(A)});return()=>F()},[p,g,h]),k.useEffect(()=>{n(d)},[]),k.useEffect(()=>{d==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[d]),k.useEffect(()=>{const F=new URLSearchParams(window.location.search),T=F.get("view"),O=F.get("formId"),q=F.get("creatorId");T==="filler"&&O&&q&&f.getState().setCurrentView("filler",{formId:O,creatorId:q})},[]);const v=k.useRef(null);if(k.useEffect(()=>(x&&r==="builder-canvas"&&(v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{b()},15e3)),()=>{v.current&&clearTimeout(v.current)}),[x,b,r]),!u)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:"Initializing Authentication..."});const N=()=>r==="filler"&&a?e.jsx(Xe,{formId:a.formId,creatorId:a.creatorId}):r==="responses"&&s?e.jsx(Me,{formId:s}):r==="builder-canvas"&&x?e.jsxs("div",{className:"flex h-screen overflow-hidden bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[e.jsx(Re,{}),e.jsx($e,{}),e.jsx(ze,{})]}):e.jsx(He,{});return e.jsxs("div",{className:`${d}`,children:[e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-100 dark:bg-gray-900",children:[r!=="filler"&&e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-md sticky top-0 z-40",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{size:28,className:"text-blue-600 dark:text-blue-400 mr-2"}),e.jsx("h1",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Form Builder Deluxe"}),m&&e.jsxs("span",{className:"ml-4 text-xs text-gray-500 dark:text-gray-400",children:["UID: ",m.substring(0,10),"..."]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[r==="builder-canvas"&&x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,title:"Undo",className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50",disabled:S.getState().historyIndex<=0,children:e.jsx(V,{size:20})}),e.jsx("button",{onClick:l,title:"Redo",className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50",disabled:S.getState().historyIndex>=S.getState().history.length-1,children:e.jsx(J,{size:20})}),e.jsx("button",{onClick:b,title:"Save Form",className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700",children:e.jsx(Y,{size:20})}),e.jsx("button",{onClick:()=>y(!0),title:"Preview Form",className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700",children:e.jsx(W,{size:20})}),e.jsx("button",{onClick:()=>f.getState().setCurrentView("builder"),title:"Back to Dashboard",className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700",children:e.jsx(G,{size:20})})]}),e.jsx("button",{onClick:()=>n(d==="light"?"dark":"light"),className:"p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700",children:d==="light"?e.jsx(Q,{size:20}):e.jsx(Z,{size:20})})]})]})}),e.jsx("main",{className:"flex-grow",children:N()}),i&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-blue-500 text-white text-sm py-2 px-4 rounded-md shadow-lg z-50",children:"Loading..."}),c&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 dark:bg-gray-200 text-white dark:text-black text-sm py-2 px-4 rounded-md shadow-lg z-50",children:c})]}),w&&x&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-center p-4 z-50 overflow-y-auto",children:[e.jsxs("div",{className:"bg-gray-200 dark:bg-gray-800 p-4 rounded-t-lg w-full max-w-3xl flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Form Preview"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>o("mobile"),className:`p-1.5 rounded ${t==="mobile"?"bg-blue-500 text-white":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>o("tablet"),className:`p-1.5 rounded ${t==="tablet"?"bg-blue-500 text-white":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,children:e.jsx(te,{size:18})}),e.jsx("button",{onClick:()=>o("desktop"),className:`p-1.5 rounded ${t==="desktop"?"bg-blue-500 text-white":"hover:bg-gray-300 dark:hover:bg-gray-700"}`,children:e.jsx(re,{size:18})})]}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-600 dark:text-gray-300 hover:text-black dark:hover:text-white text-2xl",children:"×"})]}),e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 p-4 md:p-8 w-full max-w-3xl overflow-y-auto rounded-b-lg",children:e.jsx(Be,{form:x,device:t})})]}),e.jsx(Ke,{})]})};ue.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx(Ve,{})}));
